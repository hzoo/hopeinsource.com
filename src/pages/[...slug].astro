---
import { getCollection, render } from 'astro:content';
import HomeLayout from '../layouts/HomeLayout.astro';
import EpLayout from '../layouts/EpLayout.astro';
import TableOfContents from '../components/TableOfContents.astro';

export async function getStaticPaths() {
  const podcastEntries = await getCollection('podcast');
  
  // Pre-render content at build time
  const pages = await Promise.all(
    podcastEntries.
    
    map(async (entry) => {
      const slug = entry.id.split('/').pop();
      const { Content, headings } = await render(entry);
      const h4Headings = headings.filter((h) => h.depth === 4);
      
      return {
        params: { slug },
        props: { 
          entry,
          Content,
          headings: h4Headings
        },
      };
    })
  );
  
  return pages;
}

const { entry, Content, headings } = Astro.props;
---

<HomeLayout>
<div class="wrapper">
    <div class="content-wrapper">
        <EpLayout frontmatter={entry.data} slug={`/${entry.id.split('/').pop()}`}>
            <Content />
        </EpLayout>
    </div>
    <aside class="sidebar">
        <TableOfContents headings={headings} />
    </aside>
</div>
</HomeLayout>
