---
import { getCollection, render } from 'astro:content';
import HomeLayout from '../layouts/HomeLayout.astro';
import EpLayout from '../layouts/EpLayout.astro';
import TableOfContents from '../components/TableOfContents';

export async function getStaticPaths() {
  const podcastEntries = await getCollection('podcast');
  return podcastEntries.map(entry => {
    const slug = entry.id.split('/').pop();
    return {
      params: { slug },
      props: { entry },
    };
  });
}

const { entry } = Astro.props;
const { Content, headings } = await render(entry);
const h4Headings = headings.filter((h: { depth: number }) => h.depth === 4);
---

<HomeLayout>
<div class="wrapper">
    <div class="content-wrapper">
        <EpLayout frontmatter={entry.data} slug={`/${entry.id.split('/').pop()}`}>
            <Content />
        </EpLayout>
    </div>
    <aside class="sidebar">
        <TableOfContents headings={h4Headings} client:load />
    </aside>
</div>
</HomeLayout>
