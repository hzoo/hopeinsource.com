---
const { src } = Astro.props;
---

<div
  class="fixed bottom-3 sm:bottom-4 left-1/2 lg:left-[calc(50%+160px)] z-40 w-[calc(100%-1.5rem)] sm:w-[calc(100%-2rem)] max-w-xl -translate-x-1/2 rounded-2xl border border-his-text-tertiary/50 bg-his-hover/95 text-his-text backdrop-blur-sm"
  id="audio-player-container"
  data-src={src}
>
  <div class="px-3 sm:px-4 py-2.5 sm:py-3">
    <div class="flex items-center gap-2 sm:gap-4">
      <button
        id="play-pause"
        class="flex h-10 w-10 items-center justify-center rounded-xl bg-his-green/10 text-his-green transition-all duration-200 hover:bg-his-green/20 hover:opacity-80 focus:outline-none"
        aria-label="Play/Pause"
      >
        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </button>
      <div class="group flex items-center">
        <button
          id="mute-button"
          class="flex h-8 w-8 items-center justify-center rounded-lg bg-his-green/10 text-his-green transition-all duration-200 hover:bg-his-green/20 hover:opacity-80 focus:outline-none"
          aria-label="Mute"
        >
          <svg id="volume-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
          </svg>
          <svg id="mute-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4 hidden">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
          </svg>
        </button>
        <div class="w-0 overflow-hidden transition-all duration-200 group-hover:w-24 flex items-center">
          <input
            type="range"
            id="volume-slider"
            class="w-full h-2 mx-2 appearance-none bg-his-text-tertiary/50 rounded-full"
            min="0"
            max="100"
            value="50"
          />
        </div>
      </div>
      <span id="current-time" class="w-12 text-sm font-mono text-his-text-secondary"
        >00:00</span
      >
      <div class="flex-grow relative h-2 group">
        <div class="absolute inset-0 rounded-full bg-his-text-tertiary/50"></div>
        <div
          id="progress-bar"
          class="absolute inset-y-0 left-0 w-0 rounded-full bg-his-green/40 transition-all duration-100"
        >
        </div>
        <input
          type="range"
          id="seek-slider"
          class="absolute inset-0 h-full w-full cursor-pointer opacity-0 transition-opacity group-hover:opacity-100"
          min="0"
          max="100"
          value="0"
          disabled
        />
      </div>
      <span id="duration" class="w-12 text-sm font-mono text-his-text-secondary"
        >00:00</span
      >
      <button
        id="shortcuts-button"
        class="flex h-8 w-8 items-center justify-center rounded-lg bg-his-green/10 text-his-green transition-all duration-200 hover:bg-his-green/20 hover:opacity-80 focus:outline-none"
        aria-label="Keyboard Shortcuts"
      >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
        <path fill-rule="evenodd" d="M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.331 1.652a6.993 6.993 0 0 1 1.929 1.115l1.598-.54a1 1 0 0 1 1.186.447l1.18 2.044a1 1 0 0 1-.205 1.251l-1.267 1.113a7.047 7.047 0 0 1 0 2.228l1.267 1.113a1 1 0 0 1 .206 1.25l-1.18 2.045a1 1 0 0 1-1.187.447l-1.598-.54a6.993 6.993 0 0 1-1.929 1.115l-.33 1.652a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.331-1.652a6.993 6.993 0 0 1-1.929-1.115l-1.598.54a1 1 0 0 1-1.186-.447l-1.18-2.044a1 1 0 0 1 .205-1.251l1.267-1.114a7.05 7.05 0 0 1 0-2.227L1.821 7.773a1 1 0 0 1-.206-1.25l1.18-2.045a1 1 0 0 1 1.187-.447l1.598.54A6.992 6.992 0 0 1 7.51 3.456l.33-1.652ZM10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" clip-rule="evenodd" />
      </svg>
      </button>
    </div>
  </div>
  <audio id="audio-element" preload="metadata"></audio>
</div>

<!-- Seek feedback popup -->
<div
  id="player-feedback"
  class="fixed left-1/2 -translate-x-1/2 bottom-32 z-40 bg-his-hover/95 text-his-text px-4 py-2 rounded-lg border border-his-text-tertiary/50 backdrop-blur-sm opacity-0 transition-opacity duration-200 pointer-events-none flex items-center gap-2"
>
  <span id="feedback-text" class="text-sm"></span>
</div>

<!-- Keyboard shortcuts dialog -->
<div
  id="shortcuts-dialog"
  class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden flex items-center justify-center z-50"
  aria-modal="true"
>
  <div
    class="bg-his-hover/95 text-his-text p-6 rounded-xl border border-his-text-tertiary/50 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto"
  >
    <div class="flex justify-between items-center mb-4">
      <div class="text-lg font-medium">Keyboard Shortcuts</div>
      <button id="close-shortcuts" class="text-his-text-secondary hover:text-his-text">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
            clip-rule="evenodd"></path>
        </svg>
      </button>
    </div>
    <div class="grid grid-cols-2 gap-4 text-sm">
      <div>
        <kbd class="px-2 py-1 bg-his-hover rounded">space</kbd>
        <span class="ml-2">Play/Pause</span>
      </div>
      <div>
        <kbd class="px-2 py-1 bg-his-hover rounded">m</kbd>
        <span class="ml-2">Mute/Unmute</span>
      </div>
      <div>
        <kbd class="px-2 py-1 bg-his-hover rounded">j</kbd>
        <span class="ml-2">Back 10 seconds</span>
      </div>
      <div>
        <kbd class="px-2 py-1 bg-his-hover rounded">k</kbd>
        <span class="ml-2">Forward 10 seconds</span>
      </div>
    </div>
  </div>
</div>

<script src="../scripts/audio-player.ts"></script>

<style>
  #seek-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 12px;
    width: 12px;
    border-radius: 50%;
    background: white;
    cursor: pointer;
    margin-top: -4px;
  }

  #seek-slider::-moz-range-thumb {
    height: 12px;
    width: 12px;
    border-radius: 50%;
    background: white;
    cursor: pointer;
    border: none;
  }

  /* Volume slider styles */
  #volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 12px;
    width: 12px;
    border-radius: 50%;
    background: white;
    cursor: pointer;
    margin-top: -4px;
  }

  #volume-slider::-moz-range-thumb {
    height: 12px;
    width: 12px;
    border-radius: 50%;
    background: white;
    cursor: pointer;
    border: none;
  }

  #volume-slider::-webkit-slider-runnable-track {
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
  }

  #volume-slider::-moz-range-track {
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
  }

  #volume-slider {
    background: linear-gradient(to right, rgba(255, 255, 255, 0.4) 50%, rgba(255, 255, 255, 0.2) 50%);
    border-radius: 2px;
  }
</style>
